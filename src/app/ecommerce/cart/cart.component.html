<p-confirmDialog />
<p-toast/>
<div class="cart-container">
  <!-- Header with cart summary -->
  <div class="cart-header">
    <div class="flex align-items-center">
      <i class="pi pi-shopping-cart mr-3" style="font-size: 1.5rem"></i>
      <h1>Your Shopping Cart</h1>
      <span class="cart-count-badge">{{cartItems.length}} items</span>
    </div>
    <p-button label="Clear All" 
              icon="pi pi-trash" 
              styleClass="p-button-text p-button-danger"
              (click)="clearCart()"
              [disabled]="cartItems.length === 0"></p-button>
  </div>

  <!-- Cart items with modern card design -->
  <div class="cart-items">
    <div *ngFor="let item of cartItems" class="cart-item-card">
      <div class="item-image">
        <img [src]="imageMap[item.product?.images[0]?.thumbnailPath]" 
             [alt]="item.product.name"
             class="product-thumbnail" />
      </div>
      
      <div class="item-details">
        <div class="item-header">
          <h3 class="item-title">{{item.product.name}}</h3>
          <button pButton icon="pi pi-times" 
                  class="p-button-rounded p-button-text p-button-danger"
                  (click)="removeItem(item.product.id)"></button>
        </div>
        
        <p class="item-description">{{item.product.description | truncate:100}}</p>
        
        <div class="item-meta">
          <span class="stock-status" 
                [ngClass]="{'in-stock': item.product.stockQuantity > 0, 
                           'low-stock': item.product.stockQuantity <= 5 && item.product.stockQuantity > 0,
                           'out-of-stock': item.product.stockQuantity <= 0}">
            {{item.product.stockQuantity > 0 ? (item.product.stockQuantity + ' available') : 'Out of stock'}}
          </span>
          
          <p-rating [ngModel]="item.product.ratings?.ratingValue || 5" 
                   [readonly]="true" 
                   [cancel]="false"
                   class="item-rating"></p-rating>
        </div>
      </div>
      
      <div class="item-price">
        <span class="price">{{item.product.price | currency:'TND':'symbol':'1.3-3'}}</span>
      </div>
      
      <div class="item-quantity">
        <p-inputNumber [(ngModel)]="item.quantity" 
                      [min]="1" 
                      [max]="item.product.stockQuantity"
                      [showButtons]="true"
                      buttonLayout="horizontal"
                      incrementButtonIcon="pi pi-plus" 
                      decrementButtonIcon="pi pi-minus"
                      (onChange)="updateQuantity(item, $event)"
                      inputId="quantity"></p-inputNumber>
      </div>
      
      <div class="item-total">
        <span class="total-price">{{item.product.price * item.quantity | currency:'TND':'symbol':'1.3-3'}}</span>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="cartItems.length === 0" class="empty-cart">
      <i class="pi pi-shopping-cart" style="font-size: 3rem"></i>
      <h3>Your cart is empty</h3>
      <p-button label="Continue Shopping" 
                icon="pi pi-arrow-left"
                (click)="goToShop()"></p-button>
    </div>
  </div>

  <!-- Order summary -->
  <div class="order-summary">
    <div class="summary-card">
      <h3>Order Summary</h3>
      
      <div class="summary-row">
        <span>Subtotal</span>
        <span>{{subtotal | currency:'TND':'symbol':'1.3-3'}}</span>
      </div>
      
      <div class="summary-row">
        <span>Delivery</span>
        <span>{{deliveryFee | currency:'TND':'symbol':'1.3-3'}}</span>
      </div>
      
      <div class="summary-divider"></div>
      
      <div class="summary-row total">
        <span>Total</span>
        <span>{{total | currency:'TND':'symbol':'1.3-3'}}</span>
      </div>
      
      <p-button label="Proceed to Checkout" 
                icon="pi pi-lock" 
                styleClass="checkout-button"
                (click)="confirmCheckout()"
                [disabled]="cartItems.length === 0"></p-button>
      
      
    </div>
  </div>
</div>