<!-- home.component.html -->
<div class="p-card p-3">
    

    <p-megaMenu [model]="megaMenuItems" [orientation]="'horizontal'"/>
    <br>

  <!-- Promotions Carousel -->
  <div class="promo-carousel-section mb-5">
  <h3 class="section-title">Special Offers üéÅ</h3>
  
  <p-carousel [value]="products" 
              [numVisible]="3" 
              [numScroll]="1" 
              [circular]="true"

              [autoplayInterval]="5000"
              styleClass="promo-carousel">
    <ng-template let-product pTemplate="item">
      <div class="promo-card p-3">
        <!-- Discount Badge -->
        <div class="discount-badge" *ngIf="product.discount">
          -{{ product.discount.percentage }}%
        </div>
        
        <!-- Product Image -->
        <div class="image-container mb-3">
          <img *ngIf="product.images?.length"
               [src]="imageMap[product.images[0]?.thumbnailPath]"
               [alt]="product.name"
               class="product-image"
               (click)="viewProduct(product.id)"/>
        </div>
        
        <!-- Product Details -->
        <div class="product-details">
          <h4 class="product-name mb-2">{{ product.name }}</h4>
          
          <!-- Price with strikethrough -->
          <div class="price-display mb-2">
            <span class="original-price line-through">
              {{ product.price | currency:'TND':'symbol':'1.3-3' }}
            </span>
            <span class="discounted-price ml-2">
              {{ calculateDiscountedPrice(product) | currency:'TND':'symbol':'1.3-3' }}
            </span>
          </div>
          
          <!-- Promotion Dates -->
          <small class="promo-dates text-color-secondary block mb-3" *ngIf="product.discount">
            <i class="pi pi-clock mr-1"></i>
            Ends: {{ product.discount.endDate | date:'shortDate' }}
          </small>
          
          <!-- Add to Cart -->
          <button pButton 
                  label="Add to Cart" 
                  icon="pi pi-shopping-cart" 
                  class="w-full"
                  [disabled]="product.stockQuantity === 0"
                  [class]="product.stockQuantity === 0 ? 'p-button-secondary' : 'p-button-primary'">
            <span *ngIf="product.stockQuantity === 0">Out of Stock</span>
          </button>
        </div>
      </div>
    </ng-template>
  </p-carousel>
</div>


  <!-- Top Sellers Grid -->
<div class="top-sellers-section my-5">
  <div class="flex justify-content-between align-items-center mb-3">
    <h3 class="section-title">Top Sellers üî•</h3>
    <a (click)="navigateToProductList(null)" class="see-all-link">See All</a>
  
  </div>

  <!-- PrimeNG Grid with fixed card widths -->
  <div class="p-grid p-nogutter p-justify-center">
    <div class="p-col-12 p-md-6 p-lg-4" *ngFor="let product of products">
      <p-card class="product-card fixed-width-card">
        <!-- Badge for best sellers -->
        <p-tag *ngIf="product.isBestSeller" 
               value="BEST SELLER" 
               severity="danger" 
               class="absolute top-0 right-0 m-2"></p-tag>
        
        <!-- Product Image -->
        <div class="product-image-container">
          <img [src]="imageMap[product.images[0]?.thumbnailPath]" 
               [alt]="product.name" 
               class="product-image"
               />
          <button pButton icon="pi pi-eye" 
                  class="p-button-rounded quick-view-btn"
                  (click)="viewProduct(product.id)"></button>
        </div>

        <!-- Product Details -->
        <div class="product-details">
          <h4 class="product-name">{{ product.name }}</h4>
          
          <!-- Rating -->
          <div class="rating-container">
            <p-rating [ngModel]="product.ratings.ratingValue?product.ratings.ratingValue:5" 
                     [readonly]="true" 
                     [cancel]="false"
                     [stars]="5"></p-rating>
            <span class="rating-count">({{ product.reviewCount || 0 }})</span>
          </div>

          <!-- Price -->
          <div class="price-container">
            <span class="current-price">
              {{ getFinalPrice(product) | currency:'TND':'symbol':'1.3-3' }}
            </span>
            <span *ngIf="product.discount" class="original-price">
              {{ product.price | currency:'TND':'symbol':'1.3-3' }}
            </span>
          </div>

          <!-- Add to Cart -->
          <button pButton label="Add to Cart" 
                  icon="pi pi-cart-plus" 
                  class="p-button-sm w-full mt-2"
                  [disabled]="product.stockQuantity === 0"
                  (click)="addToCart(product)">
            <span *ngIf="product.stockQuantity === 0">Out of Stock</span>
          </button>
        </div>
      </p-card>
    </div>
  </div>
</div>
</div>


<app-preview-product *ngIf="displayProductDetailDialog" [(display)]="displayProductDetailDialog"
                [productId]="productId">
</app-preview-product>